<button
  (click)="handleVoltar()"
  class="px-4 py-2 mb-4 bg-muted rounded-lg hover:bg-gray-300 transition-colors"
>
  ← Voltar
</button>

<app-header title="Cadastro de Associado" subtitle="Permite adicionar um novo associado ao sistema" />

<!-- Mensagem de erro -->
@if(errorMessage) {
  <div
    class="fixed top-2 left-1/2 transform -translate-x-1/2 z-50 w-full max-w-md"
  >
    <div class="bg-red-500 text-white p-4 rounded-lg shadow-xl flex justify-between items-center transition-opacity duration-300 opacity-95">
      <p class="font-medium mr-4">{{ errorMessage }}</p>
      <button
        class="hover:bg-red-600 p-2 rounded-lg flex items-center justify-center"
        (click)="closeError()"
      >
        <mat-icon>close</mat-icon>
      </button>
    </div>
  </div>
}

<!-- Formulário -->
<form #associadoForm="ngForm" (ngSubmit)="salvarAssociado()" class="space-y-6 mt-6">
  <!-- Nome -->
  <div>
    <label for="nome" class="block text-sm font-medium text-gray-700 mb-1">
      Nome Completo *
    </label>
    <input
      id="nome"
      type="text"
      [(ngModel)]="associado.nome"
      name="nome"
      #nomeInput="ngModel"
      [class.border-red-500]="nomeInput.invalid && nomeInput.touched"
      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white"
      placeholder="Digite o nome completo"
      required
      minlength="3"
      maxlength="100"
    />
    @if(nomeInput.invalid && nomeInput.touched) {
      <div class="text-red-500 text-sm mt-1">
        @if(nomeInput.errors?.['required']) {
          <span>Nome é obrigatório</span>
        }
        @if(nomeInput.errors?.['minlength']) {
          <span>Nome deve ter pelo menos 3 caracteres</span>
        }
      </div>
    }
  </div>

  <!-- Email -->
  <div>
    <label for="email" class="block text-sm font-medium text-gray-700 mb-1">
      E-mail *
    </label>
    <input
      id="email"
      type="email"
      [(ngModel)]="associado.email"
      name="email"
      #emailInput="ngModel"
      [class.border-red-500]="emailInput.invalid && emailInput.touched"
      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white"
      placeholder="exemplo@email.com"
      required
      email
    />
    @if(emailInput.invalid && emailInput.touched) {
      <div class="text-red-500 text-sm mt-1">
        @if(emailInput.errors?.['required']) {
          <span>E-mail é obrigatório</span>
        }
        @if(emailInput.errors?.['email']) {
          <span>Digite um e-mail válido</span>
        }
      </div>
    }
  </div>

  <!-- Telefone -->
  <div>
    <label for="telefone" class="block text-sm font-medium text-gray-700 mb-1">
      Telefone *
    </label>
    <input
      id="telefone"
      type="tel"
      [(ngModel)]="associado.telefone"
      name="telefone"
      #telefoneInput="ngModel"
      [class.border-red-500]="telefoneInput.invalid && telefoneInput.touched"
      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white"
      placeholder="(00) 00000-0000"
      required
      pattern="^\(?\d{2}\)?\s?\d{4,5}-?\d{4}$"
    />
    @if(telefoneInput.invalid && telefoneInput.touched) {
      <div class="text-red-500 text-sm mt-1">
        @if(telefoneInput.errors?.['required']) {
          <span>Telefone é obrigatório</span>
        }
        @if(telefoneInput.errors?.['pattern']) {
          <span>Digite um telefone válido (ex: (11) 99999-9999)</span>
        }
      </div>
    }
  </div>

  <!-- Cidade -->
  <div>
    <label for="cidade" class="block text-sm font-medium text-gray-700 mb-1">
      Cidade *
    </label>
    <input
      id="cidade"
      type="text"
      [(ngModel)]="associado.cidade"
      name="cidade"
      #cidadeInput="ngModel"
      [class.border-red-500]="cidadeInput.invalid && cidadeInput.touched"
      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white"
      placeholder="Digite a cidade"
      required
      minlength="2"
    />
    @if(cidadeInput.invalid && cidadeInput.touched) {
      <div class="text-red-500 text-sm mt-1">
        @if(cidadeInput.errors?.['required']) {
          <span>Cidade é obrigatória</span>
        }
        @if(cidadeInput.errors?.['minlength']) {
          <span>Cidade deve ter pelo menos 2 caracteres</span>
        }
      </div>
    }
  </div>

  <!-- Mensalidade -->
  <div>
    <label class="block text-sm font-medium text-gray-700 mb-1">
      Situação da Mensalidade *
    </label>
    <div class="flex space-x-4">
      <label class="inline-flex items-center">
        <input
          type="radio"
          [(ngModel)]="associado.mensalidade"
          name="mensalidade"
          value="em dia"
          class="h-4 w-4 text-blue-600 focus:ring-blue-500"
          required
        />
        <span class="ml-2 text-gray-700">Em dia</span>
      </label>
      <label class="inline-flex items-center">
        <input
          type="radio"
          [(ngModel)]="associado.mensalidade"
          name="mensalidade"
          value="pendente"
          class="h-4 w-4 text-blue-600 focus:ring-blue-500"
        />
        <span class="ml-2 text-gray-700">Pendente</span>
      </label>
    </div>
  </div>

  <!-- Botões -->
  <div class="flex space-x-4 pt-4">
    <button
      type="button"
      (click)="handleVoltar()"
      class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors"
    >
      Cancelar
    </button>
    <button
      type="submit"
      [disabled]="!associadoForm.form.valid || submitting"
      class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
    >
      @if(submitting) {
        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
      }
      Salvar Associado
    </button>
  </div>
</form>
